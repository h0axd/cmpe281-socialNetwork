<% include partials/head %>
<script>
$.fn.pageMe = function(opts){
  var $this = this,
  defaults = {
    perPage: 7,
    showPrevNext: false,
    hidePageNumbers: false
  },
  settings = $.extend(defaults, opts);

  var listElement = $this;
  var perPage = settings.perPage;
  var children = listElement.children();
  var pager = $('.pager');

  if (typeof settings.childSelector!="undefined") {
    children = listElement.find(settings.childSelector);
  }

  if (typeof settings.pagerSelector!="undefined") {
    pager = $(settings.pagerSelector);
  }

  var numItems = children.size();
  var numPages = Math.ceil(numItems/perPage);

  pager.data("curr",0);

  if (settings.showPrevNext){
    $('<li><a href="#" class="prev_link">«</a></li>').appendTo(pager);
  }

  var curr = 0;
  while(numPages > curr && (settings.hidePageNumbers==false)){
    $('<li><a href="#" class="page_link">'+(curr+1)+'</a></li>').appendTo(pager);
    curr++;
  }

  if (settings.showPrevNext){
    $('<li><a href="#" class="next_link">»</a></li>').appendTo(pager);
  }

  pager.find('.page_link:first').addClass('active');
  pager.find('.prev_link').hide();
  if (numPages<=1) {
    pager.find('.next_link').hide();
  }
  pager.children().eq(1).addClass("active");

  children.hide();
  children.slice(0, perPage).show();

  pager.find('li .page_link').click(function(){
    var clickedPage = $(this).html().valueOf()-1;
    goTo(clickedPage,perPage);
    return false;
  });
  pager.find('li .prev_link').click(function(){
    previous();
    return false;
  });
  pager.find('li .next_link').click(function(){
    next();
    return false;
  });

  function previous(){
    var goToPage = parseInt(pager.data("curr")) - 1;
    goTo(goToPage);
  }

  function next(){
    goToPage = parseInt(pager.data("curr")) + 1;
    goTo(goToPage);
  }

  function goTo(page){
    var startAt = page * perPage,
    endOn = startAt + perPage;

    children.css('display','none').slice(startAt, endOn).show();

    if (page>=1) {
      pager.find('.prev_link').show();
    }
    else {
      pager.find('.prev_link').hide();
    }

    if (page<(numPages-1)) {
      pager.find('.next_link').show();
    }
    else {
      pager.find('.next_link').hide();
    }

    pager.data("curr",page);
    pager.children().removeClass("active");
    pager.children().eq(page+1).addClass("active");

  }
};

$(document).ready(function(){

  $('#myTable').pageMe({pagerSelector:'#myPager',showPrevNext:true,hidePageNumbers:false,perPage:4});

  $('#ledon-button').click(function() {
    $.ajax({
      type: 'POST',
      url: 'http://localhost:3000/new'

    });
  });
});

$(document).ready(function(){

});
$(document).on("click", "#restart", function(e) {
  var currentRow = $(this).closest('tr');
  var cells = $(currentRow).find('td');
  var result = cells.eq(1).text();

  $.ajax({
    type: 'POST',
    url: '/restart',
    data: { result: result}

  });
});
$(document).on("click", "#stopped", function(e) {
  var currentRow = $(this).closest('tr');
  var cells = $(currentRow).find('td');
  var result = cells.eq(1).text();

  $.ajax({
    type: 'POST',
    url: '/stopped',
    data: { result: result}

  });
});
</script>

<body>
  <div class="col-sm-10 col-sm-offset-1">
    <div class="jumbotron text-center">
      <h1 class=" fa fa-user"> System Administrator Dashboard</h1><br>
      <span class="fa fa-sign-out"><a href="/"> Sign out</a></span>
      <hr>
      <div class="container">
        <div class="row">
          <div class="col-md-10 col-md-offset-1">            
            <div class="panel panel-default panel-table">
              <div class="panel-heading">
                <div class="row">
                  <div class="col col-xs-6">
                  </div>
                  <div class="col col-xs-6 text-right">

                    <button id='ledon-button' type="button"  class="btn btn-success btn-lg">Start an Instance</button>
                  </div>
                </div>
              </div>
              <div class="panel-body table-responsive">
                <table class="table table-striped table-bordered table-list" id ="instance">
                  <thead>
                    <tr>
                      <th><em class="fa fa-cog"></em></th>
                      <th class="hidden-xs">ID</th>
                      <th>Instance Name</th>
                      <th>Location</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="myTable">
                    <% user.forEach(function(i) { %>
                      <tr>
                        <td align="center">
                          <a id = "restart" class="btn btn-default"><em class="glyphicon glyphicon-refresh"></em></a>
                          <a id = "stopped" input type="button" class="btn btn-danger"><em class="fa fa-trash" value = "trash" onclick = "testStop(this)"></em></a>
                        </td>
                        <td id = "id">
                          <%= i.id %>
                        </td>
                        <td>
                          <%= i.name %>
                        </td>
                        <td>
                          <%= i.location %>
                        </td>
                        <td>
                          <%= i.active %>
                        </td>
                      </tr>
                      <% }); %>
                    </tbody>
                  </table>

                </div>
                <div class="panel-footer">
                  <div class="row">

                    <div class="col col-xs-8">
                      <ul class="pagination hidden-xs pull-right" id="myPager">
                      </ul>
                      <ul class="pagination visible-xs pull-right">
                        <li><a href="#">«</a></li>
                        <li><a href="#">»</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

            </div></div></div>
          </div>
        </div>
      </body>
      </html>
